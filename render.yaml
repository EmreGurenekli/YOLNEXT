# Render.com Deployment Configuration
# Backend ve Database için Render deployment ayarları

services:
  # PostgreSQL Database
  - type: postgres
    name: yolnext-database
    databaseName: yolnext
    user: yolnext_user
    plan: starter  # free tier için "starter", production için "standard" veya daha yüksek
    postgresMajorVersion: 15

  # Backend API Service
  - type: web
    name: yolnext-backend
    runtime: node
    plan: starter  # free tier için "starter"
    buildCommand: cd backend && npm install
    startCommand: cd backend && node server-modular.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000  # Render otomatik PORT atar, ama belirtmek iyi
      - key: DATABASE_URL
        fromDatabase:
          name: yolnext-database
          property: connectionString
      - key: JWT_SECRET
        generateValue: true  # Render otomatik generate eder
      - key: FRONTEND_ORIGIN
        value: https://imaginative-lokum-aff632.netlify.app
      - key: DB_POOL_MAX
        value: "20"
      - key: DB_IDLE_TIMEOUT
        value: "30000"
      - key: DB_CONNECTION_TIMEOUT
        value: "2000"
    healthCheckPath: /api/health/live
    autoDeploy: true  # GitHub push'ta otomatik deploy

# Not: Environment variables Render dashboard'dan da ayarlanabilir:
# - EMAIL_SMTP_URL: Email servisi için (opsiyonel)
# - IYZICO_API_KEY: Ödeme gateway için (opsiyonel)
# - IYZICO_SECRET_KEY: Ödeme gateway için (opsiyonel)
# - SENTRY_DSN: Error tracking için (opsiyonel)
